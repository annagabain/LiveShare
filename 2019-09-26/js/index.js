// Generated by CoffeeScript 2.4.1
var Database, PATH, PORT, _, app, db, express, fs;

fs = require('fs');

_ = require('lodash');

PATH = 'db.txt';

express = require('express');

app = express();

app.use(express.urlencoded({
  extended: false // req.body
}));


// todo:
//   id   1
//   text "Feed the Cat"
//   done false
Database = class Database {
  constructor() {
    this.read();
  }

  read() {
    return Object.assign(this, JSON.parse(fs.readFileSync(PATH, 'utf-8')));
  }

  write() {
    return fs.writeFileSync(PATH, JSON.stringify(this));
  }

  add(text) {
    this.todos.push({
      id: ++this.last,
      text: text,
      done: false
    });
    return this.write();
  }

  clear() {
    this.last = 0;
    this.todos = [];
    return this.write();
  }

  delete(id) {
    var result;
    result = this.todos.find(function(todo) {
      return todo.id === id;
    });
    this.todos = this.todos.filter(function(todo) {
      return todo.id !== id;
    });
    this.write();
    return result;
  }

};

db = new Database();

app.post('/todos', function(req, res) {
  db.add(req.body.text);
  return res.send(_.last(db.todos));
});

app.get('/todos', function(req, res) {
  return res.send(db.todos);
});

app.get('/todos/:id', function(req, res) {
  return res.send(db.todos.find(function(todo) {
    return todo.id === parseInt(req.params.id);
  }));
});

app.put('/todos/:id', function(req, res) {
  var todo;
  todo = db.todos.find(function(todo) {
    return todo.id === parseInt(req.params.id);
  });
  todo.text = req.body.text;
  todo.done = JSON.parse(req.body.done);
  db.write();
  return res.send(todo);
});

app.patch('/todos/:id', function(req, res) {
  var todo;
  todo = db.todos.find(function(todo) {
    return todo.id === parseInt(req.params.id);
  });
  todo.text = req.body.text || todo.text;
  todo.done = JSON.parse(req.body.done || todo.done);
  db.write();
  return res.send(todo);
});

app.delete('/todos', function(req, res) {
  db.clear();
  return res.send(db.todos);
});

app.delete('/todos/:id', function(req, res) {
  return res.send(db.delete(parseInt(req.params.id)));
});

PORT = process.env.PORT || 3000;

app.listen(PORT, function() {
  return console.log(`Server started on port ${PORT}`);
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiLi4iLCJzb3VyY2VzIjpbImNvZmZlZVxcaW5kZXguY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxJQUFBLFFBQUEsRUFBQSxJQUFBLEVBQUEsSUFBQSxFQUFBLENBQUEsRUFBQSxHQUFBLEVBQUEsRUFBQSxFQUFBLE9BQUEsRUFBQTs7QUFBQSxFQUFBLEdBQUssT0FBQSxDQUFRLElBQVI7O0FBQ0wsQ0FBQSxHQUFJLE9BQUEsQ0FBUSxRQUFSOztBQUNKLElBQUEsR0FBTzs7QUFFUCxPQUFBLEdBQVUsT0FBQSxDQUFRLFNBQVI7O0FBQ1YsR0FBQSxHQUFNLE9BQUEsQ0FBQTs7QUFDTixHQUFHLENBQUMsR0FBSixDQUFRLE9BQU8sQ0FBQyxVQUFSLENBQW1CO0VBQUUsUUFBQSxFQUFVLEtBQVo7QUFBQSxDQUFuQixDQUFSLEVBTkE7Ozs7Ozs7QUFhTSxXQUFOLE1BQUEsU0FBQTtFQUNDLFdBQWMsQ0FBQSxDQUFBO0lBQU0sSUFBQyxDQUFBLElBQUQsQ0FBQTtFQUFOOztFQUVkLElBQU8sQ0FBQSxDQUFBO1dBQUcsTUFBTSxDQUFDLE1BQVAsQ0FBYyxJQUFkLEVBQWlCLElBQUksQ0FBQyxLQUFMLENBQVcsRUFBRSxDQUFDLFlBQUgsQ0FBZ0IsSUFBaEIsRUFBcUIsT0FBckIsQ0FBWCxDQUFqQjtFQUFIOztFQUNQLEtBQVEsQ0FBQSxDQUFBO1dBQUcsRUFBRSxDQUFDLGFBQUgsQ0FBaUIsSUFBakIsRUFBdUIsSUFBSSxDQUFDLFNBQUwsQ0FBZSxJQUFmLENBQXZCO0VBQUg7O0VBRVIsR0FBTSxDQUFDLElBQUQsQ0FBQTtJQUNMLElBQUMsQ0FBQSxLQUFLLENBQUMsSUFBUCxDQUFZO01BQUMsRUFBQSxFQUFJLEVBQUUsSUFBQyxDQUFBLElBQVI7TUFBYyxJQUFBLEVBQU0sSUFBcEI7TUFBMEIsSUFBQSxFQUFNO0lBQWhDLENBQVo7V0FDQSxJQUFDLENBQUEsS0FBRCxDQUFBO0VBRks7O0VBSU4sS0FBUSxD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R0FBRyxDQUFDLE1BQUosQ0FBVyxRQUFYLEVBQXFCLFFBQUEsQ0FBQyxHQUFELEVBQU0sR0FBTixDQUFBO0VBQ3BCLEVBQUUsQ0FBQyxLQUFILENBQUE7U0FDQSxHQUFHLENBQUMsSUFBSixDQUFTLEVBQUUsQ0FBQyxLQUFaO0FBRm9CLENBQXJCOztBQUlBLEdBQUcsQ0FBQyxNQUFKLENBQVcsWUFBWCxFQUF5QixRQUFBLENBQUMsR0FBRCxFQUFNLEdBQU4sQ0FBQTtTQUFjLEdBQUcsQ0FBQyxJQUFKLENBQVMsRUFBRSxDQUFDLE1BQUgsQ0FBVSxRQUFBLENBQVMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFwQixDQUFWLENBQVQ7QUFBZCxDQUF6Qjs7QUFFQSxJQUFBLEdBQU8sT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFaLElBQW9COztBQUMzQixHQUFHLENBQUMsTUFBSixDQUFXLElBQVgsRUFBaUIsUUFBQSxDQUFBLENBQUE7U0FBRyxPQUFPLENBQUMsR0FBUixDQUFZLENBQUEsdUJBQUEsQ0FBQSxDQUEwQixJQUExQixDQUFBLENBQVo7QUFBSCxDQUFqQiIsInNvdXJjZXNDb250ZW50IjpbImZzID0gcmVxdWlyZSAnZnMnXHJcbl8gPSByZXF1aXJlICdsb2Rhc2gnXHJcblBBVEggPSAnZGIudHh0J1xyXG5cclxuZXhwcmVzcyA9IHJlcXVpcmUgJ2V4cHJlc3MnXHJcbmFwcCA9IGV4cHJlc3MoKVxyXG5hcHAudXNlIGV4cHJlc3MudXJsZW5jb2RlZCB7IGV4dGVuZGVkOiBmYWxzZSB9ICMgcmVxLmJvZHlcclxuXHJcbiMgdG9kbzpcclxuIyAgIGlkICAgMVxyXG4jICAgdGV4dCBcIkZlZWQgdGhlIENhdFwiXHJcbiMgICBkb25lIGZhbHNlXHJcblxyXG5jbGFzcyBEYXRhYmFzZSBcclxuXHRjb25zdHJ1Y3RvciA6ICgpIC0+IEByZWFkKClcclxuXHJcblx0cmVhZCA6IC0+IE9iamVjdC5hc3NpZ24gQCwgSlNPTi5wYXJzZSBmcy5yZWFkRmlsZVN5bmMgUEFUSCwndXRmLTgnXHJcblx0d3JpdGUgOiAtPiBmcy53cml0ZUZpbGVTeW5jIFBBVEgsIEpTT04uc3RyaW5naWZ5IEBcclxuXHJcblx0YWRkIDogKHRleHQpIC0+IFxyXG5cdFx0QHRvZG9zLnB1c2gge2lkOiArK0BsYXN0LCB0ZXh0OiB0ZXh0LCBkb25lOiBmYWxzZX1cclxuXHRcdEB3cml0ZSgpXHJcblxyXG5cdGNsZWFyIDogKCkgLT5cclxuXHRcdEBsYXN0ID0gMFxyXG5cdFx0QHRvZG9zID0gW11cclxuXHRcdEB3cml0ZSgpXHJcblxyXG5cdGRlbGV0ZSA6IChpZCkgLT5cclxuXHRcdHJlc3VsdCA9IEB0b2Rvcy5maW5kICh0b2RvKSAtPiB0b2RvLmlkID09IGlkXHJcblx0XHRAdG9kb3MgPSBAdG9kb3MuZmlsdGVyICh0b2RvKSAtPiB0b2RvLmlkICE9IGlkXHJcblx0XHRAd3JpdGUoKVxyXG5cdFx0cmVzdWx0XHJcblxyXG5kYiA9IG5ldyBEYXRhYmFzZSgpXHJcblxyXG5hcHAucG9zdCAnL3RvZG9zJywgKHJlcSwgcmVzKSAtPlxyXG5cdGRiLmFkZCByZXEuYm9keS50ZXh0XHJcblx0cmVzLnNlbmQgXy5sYXN0IGRiLnRvZG9zXHJcblxyXG5hcHAuZ2V0ICcvdG9kb3MnLCAocmVxLCByZXMpIC0+IHJlcy5zZW5kIGRiLnRvZG9zXHJcblxyXG5hcHAuZ2V0ICcvdG9kb3MvOmlkJywgKHJlcSwgcmVzKSAtPiByZXMuc2VuZCBkYi50b2Rvcy5maW5kICh0b2RvKSAtPiB0b2RvLmlkID09IHBhcnNlSW50IHJlcS5wYXJhbXMuaWRcclxuXHJcbmFwcC5wdXQgJy90b2Rvcy86aWQnLCAocmVxLCByZXMpIC0+IFxyXG5cdHRvZG8gPSBkYi50b2Rvcy5maW5kICh0b2RvKSAtPiB0b2RvLmlkID09IHBhcnNlSW50IHJlcS5wYXJhbXMuaWRcclxuXHR0b2RvLnRleHQgPSByZXEuYm9keS50ZXh0XHJcblx0dG9kby5kb25lID0gSlNPTi5wYXJzZSByZXEuYm9keS5kb25lXHJcblx0ZGIud3JpdGUoKVxyXG5cdHJlcy5zZW5kIHRvZG9cclxuXHJcbmFwcC5wYXRjaCAnL3RvZG9zLzppZCcsIChyZXEsIHJlcykgLT5cclxuXHR0b2RvID0gZGIudG9kb3MuZmluZCAodG9kbykgLT4gdG9kby5pZCA9PSBwYXJzZUludCByZXEucGFyYW1zLmlkXHJcblx0dG9kby50ZXh0ID0gcmVxLmJvZHkudGV4dCB8fCB0b2RvLnRleHRcclxuXHR0b2RvLmRvbmUgPSBKU09OLnBhcnNlIHJlcS5ib2R5LmRvbmUgfHwgdG9kby5kb25lXHJcblx0ZGIud3JpdGUoKVxyXG5cdHJlcy5zZW5kIHRvZG9cclxuXHJcbmFwcC5kZWxldGUgJy90b2RvcycsIChyZXEsIHJlcykgLT5cclxuXHRkYi5jbGVhcigpXHJcblx0cmVzLnNlbmQgZGIudG9kb3NcclxuXHJcbmFwcC5kZWxldGUgJy90b2Rvcy86aWQnLCAocmVxLCByZXMpIC0+IHJlcy5zZW5kIGRiLmRlbGV0ZSBwYXJzZUludCByZXEucGFyYW1zLmlkXHJcblxyXG5QT1JUID0gcHJvY2Vzcy5lbnYuUE9SVCB8fCAzMDAwXHJcbmFwcC5saXN0ZW4gUE9SVCwgLT4gY29uc29sZS5sb2cgXCJTZXJ2ZXIgc3RhcnRlZCBvbiBwb3J0ICN7UE9SVH1cIiJdfQ==
//# sourceURL=c:\github\LiveShare\2019-09-26\coffee\index.coffee