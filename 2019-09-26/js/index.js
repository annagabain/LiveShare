// Generated by CoffeeScript 2.4.1
var Database, PATH, PORT, app, db, express, last, readFileSync, writeFileSync;

({readFileSync, writeFileSync} = require('fs'));

({last} = require('lodash'));

PATH = 'db.txt';

express = require('express');

app = express();

app.use(express.urlencoded({
  extended: false // req.body
}));

Database = class Database { // todo = {id:"1", text:"Feed the Cat", done:false}
  constructor() {
    this.read();
  }

  read() {
    return Object.assign(this, JSON.parse(readFileSync(PATH, 'utf-8')));
  }

  write() {
    return writeFileSync(PATH, JSON.stringify(this));
  }

  post1(req, res) {
    var body;
    body = req.body;
    this.todos.push({
      id: `${++this.last}`,
      text: body.text,
      done: false
    });
    this.write();
    return res.send(last(this.todos));
  }

  get(req, res) {
    return res.send(this.todos);
  }

  get1(req, res) {
    var todo;
    todo = this.todos.find(function(todo) {
      return todo.id === req.params.id;
    });
    if (!todo) {
      return this.sendError404(req, res);
    }
    return res.send(todo);
  }

  patch1(req, res) {
    var todo;
    todo = this.todos.find(function(todo) {
      return todo.id === req.params.id;
    });
    if (!todo) {
      return this.sendError404(req, res);
    }
    if (req.body.text) {
      todo.text = req.body.text;
    }
    if (req.body.done) {
      todo.done = JSON.parse(req.body.done);
    }
    this.write();
    return res.send(todo);
  }

  delete(req, res) {
    this.last = 0;
    this.todos = [];
    this.write();
    return res.send(this.todos);
  }

  delete1(req, res) {
    var todo;
    todo = this.todos.find(function(todo) {
      return todo.id === req.params.id;
    });
    if (!todo) {
      return this.sendError404(req, res);
    }
    this.todos = this.todos.filter(function(todo) {
      return todo.id !== req.params.id;
    });
    this.write();
    return res.send(todo);
  }

  sendError404(req, res) {
    return res.status(404).send({
      error: 404,
      message: "id does not exist",
      params: req.params,
      body: req.body
    });
  }

};

db = new Database();

app.post('/todos', function(req, res) {
  return db.post1(req, res);
});

app.get('/todos', function(req, res) {
  return db.get(req, res);
});

app.get('/todos/:id', function(req, res) {
  return db.get1(req, res);
});

app.patch('/todos/:id', function(req, res) {
  return db.patch1(req, res);
});

app.delete('/todos/:id', function(req, res) {
  return db.delete1(req, res);
});

app.delete('/todos', function(req, res) {
  return db.delete(req, res);
});

PORT = process.env.PORT || 3000;

app.listen(PORT, function() {
  return console.log(`Server started on port ${PORT}`);
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiLi4iLCJzb3VyY2VzIjpbImNvZmZlZVxcaW5kZXguY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxJQUFBLFFBQUEsRUFBQSxJQUFBLEVBQUEsSUFBQSxFQUFBLEdBQUEsRUFBQSxFQUFBLEVBQUEsT0FBQSxFQUFBLElBQUEsRUFBQSxZQUFBLEVBQUE7O0FBQUEsQ0FBQSxDQUFDLFlBQUQsRUFBZSxhQUFmLENBQUEsR0FBZ0MsT0FBQSxDQUFRLElBQVIsQ0FBaEM7O0FBQ0EsQ0FBQSxDQUFDLElBQUQsQ0FBQSxHQUFTLE9BQUEsQ0FBUSxRQUFSLENBQVQ7O0FBQ0EsSUFBQSxHQUFPOztBQUVQLE9BQUEsR0FBVSxPQUFBLENBQVEsU0FBUjs7QUFDVixHQUFBLEdBQU0sT0FBQSxDQUFBOztBQUNOLEdBQUcsQ0FBQyxHQUFKLENBQVEsT0FBTyxDQUFDLFVBQVIsQ0FBbUI7RUFBRSxRQUFBLEVBQVUsS0FBWjtBQUFBLENBQW5CLENBQVI7O0FBRU0sV0FBTixNQUFBLFNBQUEsQ0FBQTtFQUNDLFdBQWMsQ0FBQSxDQUFBO0lBQUcsSUFBQyxDQUFBLElBQUQsQ0FBQTtFQUFIOztFQUVkLElBQU8sQ0FBQSxDQUFBO1dBQUcsTUFBTSxDQUFDLE1BQVAsQ0FBYyxJQUFkLEVBQWlCLElBQUksQ0FBQyxLQUFMLENBQVcsWUFBQSxDQUFhLElBQWIsRUFBa0IsT0FBbEIsQ0FBWCxDQUFqQjtFQUFIOztFQUNQLEtBQVEsQ0FBQSxDQUFBO1dBQUcsYUFBQSxDQUFjLElBQWQsRUFBb0IsSUFBSSxDQUFDLFNBQUwsQ0FBZSxJQUFmLENBQXBCO0VBQUg7O0VBRVIsS0FBUSxDQUFDLEdBQUQsRUFBSyxHQUFMLENBQUE7QUFDUCxRQUFBO0lBQUEsSUFBQSxHQUFPLEdBQUcsQ0FBQztJQUNYLElBQUMsQ0FBQSxLQUFLLENBQUMsSUFBUCxDQUFZO01BQUMsRUFBQSxFQUFJLENBQUEsQ0FBQSxDQUFHLEVBQUUsSUFBQyxDQUFBLElB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QSxDQUEwQixJQUExQixDQUFBLENBQVo7QUFBSCxDQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIntyZWFkRmlsZVN5bmMsIHdyaXRlRmlsZVN5bmN9ID0gcmVxdWlyZSAnZnMnXHJcbntsYXN0fSA9IHJlcXVpcmUgJ2xvZGFzaCdcclxuUEFUSCA9ICdkYi50eHQnXHJcblxyXG5leHByZXNzID0gcmVxdWlyZSAnZXhwcmVzcydcclxuYXBwID0gZXhwcmVzcygpXHJcbmFwcC51c2UgZXhwcmVzcy51cmxlbmNvZGVkIHsgZXh0ZW5kZWQ6IGZhbHNlIH0gIyByZXEuYm9keVxyXG5cclxuY2xhc3MgRGF0YWJhc2UgICAjIHRvZG8gPSB7aWQ6XCIxXCIsIHRleHQ6XCJGZWVkIHRoZSBDYXRcIiwgZG9uZTpmYWxzZX1cclxuXHRjb25zdHJ1Y3RvciA6IC0+IEByZWFkKClcclxuXHJcblx0cmVhZCA6IC0+IE9iamVjdC5hc3NpZ24gQCwgSlNPTi5wYXJzZSByZWFkRmlsZVN5bmMgUEFUSCwndXRmLTgnXHJcblx0d3JpdGUgOiAtPiB3cml0ZUZpbGVTeW5jIFBBVEgsIEpTT04uc3RyaW5naWZ5IEBcclxuXHJcblx0cG9zdDEgOiAocmVxLHJlcykgLT4gXHJcblx0XHRib2R5ID0gcmVxLmJvZHlcclxuXHRcdEB0b2Rvcy5wdXNoIHtpZDogXCIjeysrQGxhc3R9XCIsIHRleHQ6IGJvZHkudGV4dCwgZG9uZTogZmFsc2V9XHJcblx0XHRAd3JpdGUoKVxyXG5cdFx0cmVzLnNlbmQgbGFzdCBAdG9kb3NcclxuXHJcblx0Z2V0ICA6IChyZXEscmVzKSAtPiByZXMuc2VuZCBAdG9kb3NcclxuXHRnZXQxIDogKHJlcSxyZXMpIC0+IFxyXG5cdFx0dG9kbyA9IEB0b2Rvcy5maW5kICh0b2RvKSAtPiB0b2RvLmlkID09IHJlcS5wYXJhbXMuaWRcclxuXHRcdGlmIG5vdCB0b2RvIHRoZW4gcmV0dXJuIEBzZW5kRXJyb3I0MDQgcmVxLCByZXNcclxuXHRcdHJlcy5zZW5kIHRvZG9cclxuXHJcblx0cGF0Y2gxIDogKHJlcSxyZXMpIC0+XHJcblx0XHR0b2RvID0gQHRvZG9zLmZpbmQgKHRvZG8pIC0+IHRvZG8uaWQgPT0gcmVxLnBhcmFtcy5pZFxyXG5cdFx0aWYgbm90IHRvZG8gdGhlbiByZXR1cm4gQHNlbmRFcnJvcjQwNCByZXEsIHJlc1xyXG5cdFx0aWYgcmVxLmJvZHkudGV4dCB0aGVuIHRvZG8udGV4dCA9IHJlcS5ib2R5LnRleHRcclxuXHRcdGlmIHJlcS5ib2R5LmRvbmUgdGhlbiB0b2RvLmRvbmUgPSBKU09OLnBhcnNlIHJlcS5ib2R5LmRvbmVcclxuXHRcdEB3cml0ZSgpXHJcblx0XHRyZXMuc2VuZCB0b2RvXHJcblxyXG5cdGRlbGV0ZSA6IChyZXEscmVzKSAtPlxyXG5cdFx0QGxhc3QgPSAwXHJcblx0XHRAdG9kb3MgPSBbXVxyXG5cdFx0QHdyaXRlKClcclxuXHRcdHJlcy5zZW5kIEB0b2Rvc1xyXG5cclxuXHRkZWxldGUxIDogKHJlcSxyZXMpIC0+XHJcblx0XHR0b2RvICAgPSBAdG9kb3MuZmluZCAgICh0b2RvKSAtPiB0b2RvLmlkID09IHJlcS5wYXJhbXMuaWRcclxuXHRcdGlmIG5vdCB0b2RvIHRoZW4gcmV0dXJuIEBzZW5kRXJyb3I0MDQgcmVxLCByZXNcclxuXHRcdEB0b2RvcyA9IEB0b2Rvcy5maWx0ZXIgKHRvZG8pIC0+IHRvZG8uaWQgIT0gcmVxLnBhcmFtcy5pZFxyXG5cdFx0QHdyaXRlKClcclxuXHRcdHJlcy5zZW5kIHRvZG9cclxuXHJcblx0c2VuZEVycm9yNDA0IDogKHJlcSxyZXMpIC0+XHRyZXMuc3RhdHVzKDQwNCkuc2VuZCB7ZXJyb3I6NDA0LCBtZXNzYWdlOlwiaWQgZG9lcyBub3QgZXhpc3RcIiwgcGFyYW1zOnJlcS5wYXJhbXMsIGJvZHk6cmVxLmJvZHl9XHJcblxyXG5kYiA9IG5ldyBEYXRhYmFzZSgpXHJcblxyXG5hcHAucG9zdCAgICcvdG9kb3MnLCAgICAgKHJlcSwgcmVzKSAtPiBkYi5wb3N0MSAgIHJlcSxyZXMgXHJcbmFwcC5nZXQgICAgJy90b2RvcycsICAgICAocmVxLCByZXMpIC0+IGRiLmdldCAgICAgcmVxLHJlcyBcclxuYXBwLmdldCAgICAnL3RvZG9zLzppZCcsIChyZXEsIHJlcykgLT4gZGIuZ2V0MSAgICByZXEscmVzIFxyXG5hcHAucGF0Y2ggICcvdG9kb3MvOmlkJywgKHJlcSwgcmVzKSAtPiBkYi5wYXRjaDEgIHJlcSxyZXMgXHJcbmFwcC5kZWxldGUgJy90b2Rvcy86aWQnLCAocmVxLCByZXMpIC0+IGRiLmRlbGV0ZTEgcmVxLHJlcyBcclxuYXBwLmRlbGV0ZSAnL3RvZG9zJywgICAgIChyZXEsIHJlcykgLT4gZGIuZGVsZXRlICByZXEscmVzIFxyXG5cclxuUE9SVCA9IHByb2Nlc3MuZW52LlBPUlQgfHwgMzAwMFxyXG5hcHAubGlzdGVuIFBPUlQsIC0+IGNvbnNvbGUubG9nIFwiU2VydmVyIHN0YXJ0ZWQgb24gcG9ydCAje1BPUlR9XCIiXX0=
//# sourceURL=c:\github\LiveShare\2019-09-26\coffee\index.coffee