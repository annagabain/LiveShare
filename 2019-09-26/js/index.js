// Generated by CoffeeScript 2.4.1
var Database, PORT, app, db, express, last, readFileSync, writeFileSync;

({readFileSync, writeFileSync} = require('fs'));

({last} = require('lodash'));

express = require('express');

app = express();

app.use(express.urlencoded({
  extended: false // req.body
}));

Database = class Database { // todo = {id:"1", text:"Feed the Cat", done:false}
  constructor(path) {
    this.path = path;
    this.read();
  }

  read() {
    return Object.assign(this, JSON.parse(readFileSync(this.path, 'utf-8')));
  }

  write() {
    return writeFileSync(this.path, JSON.stringify(this));
  }

  add(body) {
    this.todos.push({
      id: `${++this.last}`,
      text: body.text,
      done: false
    });
    this.write();
    return last(this.todos);
  }

  clear() {
    this.last = 0;
    this.todos = [];
    this.write();
    return this.todos;
  }

  delete(id) {
    var todo;
    todo = this.todos.find(function(todo) {
      return todo.id === id;
    });
    this.todos = this.todos.filter(function(todo) {
      return todo.id !== id;
    });
    this.write();
    return todo;
  }

  patch(id, body) {
    var todo;
    todo = this.todos.find(function(todo) {
      return todo.id === id;
    });
    if (body.text) {
      todo.text = body.text;
    }
    if (body.done) {
      todo.done = JSON.parse(body.done);
    }
    this.write();
    return todo;
  }

};

db = new Database('db.txt');

app.post('/todos', function(req, res) {
  return res.send(db.add(req.body));
});

app.get('/todos', function(req, res) {
  return res.send(db.todos);
});

app.get('/todos/:id', function(req, res) {
  return res.send(db.todos.find(function(todo) {
    return todo.id === req.params.id;
  }));
});

app.patch('/todos/:id', function(req, res) {
  return res.send(db.patch(req.params.id, req.body));
});

app.delete('/todos/:id', function(req, res) {
  return res.send(db.delete(req.params.id));
});

app.delete('/todos', function(req, res) {
  return res.send(db.clear());
});

PORT = process.env.PORT || 3000;

app.listen(PORT, function() {
  return console.log(`Server started on port ${PORT}`);
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiLi4iLCJzb3VyY2VzIjpbImNvZmZlZVxcaW5kZXguY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxJQUFBLFFBQUEsRUFBQSxJQUFBLEVBQUEsR0FBQSxFQUFBLEVBQUEsRUFBQSxPQUFBLEVBQUEsSUFBQSxFQUFBLFlBQUEsRUFBQTs7QUFBQSxDQUFBLENBQUMsWUFBRCxFQUFlLGFBQWYsQ0FBQSxHQUFnQyxPQUFBLENBQVEsSUFBUixDQUFoQzs7QUFDQSxDQUFBLENBQUMsSUFBRCxDQUFBLEdBQVMsT0FBQSxDQUFRLFFBQVIsQ0FBVDs7QUFFQSxPQUFBLEdBQVUsT0FBQSxDQUFRLFNBQVI7O0FBQ1YsR0FBQSxHQUFNLE9BQUEsQ0FBQTs7QUFDTixHQUFHLENBQUMsR0FBSixDQUFRLE9BQU8sQ0FBQyxVQUFSLENBQW1CO0VBQUUsUUFBQSxFQUFVLEtBQVo7QUFBQSxDQUFuQixDQUFSOztBQUVNLFdBQU4sTUFBQSxTQUFBLENBQUE7RUFDQyxXQUFjLEtBQUEsQ0FBQTtJQUFDLElBQUMsQ0FBQTtJQUFTLElBQUMsQ0FBQSxJQUFELENBQUE7RUFBWDs7RUFFZCxJQUFPLENBQUEsQ0FBQTtXQUFHLE1BQU0sQ0FBQyxNQUFQLENBQWMsSUFBZCxFQUFpQixJQUFJLENBQUMsS0FBTCxDQUFXLFlBQUEsQ0FBYSxJQUFDLENBQUEsSUFBZCxFQUFtQixPQUFuQixDQUFYLENBQWpCO0VBQUg7O0VBQ1AsS0FBUSxDQUFBLENBQUE7V0FBRyxhQUFBLENBQWMsSUFBQyxDQUFBLElBQWYsRUFBcUIsSUFBSSxDQUFDLFNBQUwsQ0FBZSxJQUFmLENBQXJCO0VBQUg7O0VBRVIsR0FBTSxDQUFDLElBQUQsQ0FBQTtJQUNMLElBQUMsQ0FBQSxLQUFLLENBQUMsSUFBUCxDQUFZO01BQUMsRUFBQSxFQUFJLENBQUEsQ0FBQSxDQUFHLEVBQUUsSUFBQyxDQUFBLElBQU4sQ0FBQSxDQUFMO01BQW1CLElBQUEsRUFBTSxJQUFJLENBQUMsSUFBOUI7TUFBb0MsSUFBQSxFQUFNO0lBQTFDLENBQVo7SUFDQSxJQUFDLENBQUEsS0FBRCxDQUFBO1dBQ0EsSUFBQSxDQUFLLElBQUMsQ0FBQSxLQUFOO0VBSEs7O0VBS04sS0FBUSxDQUFBLENBQUE7SUFDUCxJQUFDLENBQUEsSUFBRCxHQUFRO0lBQ1IsSUFBQyxDQUFBLEtBQUQsR0FBUztJQUNULElBQUMsQ0FBQSxLQUFELENBQUE7V0FDQSxJQUFDLENBQUE7RUFKTTs7RUFNUixNQUFTLENBQUMsRUFBRCxDQUFBO0FBQ1IsUUFBQTtJQUFBLElBQUEsR0FBTyxJQUFDLENBQUEsS0FBSyxDQUFDLElBQVAsQ0FBWSxRQUFBLENBQUMsSUFBRCxDQUFBO2FBQVUsSUFBSSxDQUFDLEVBQUwsS0FBVztJQUFyQixDQUFaO0lBQ1AsSUFBQyxDQUFBLEtBQUQsR0FBUyxJQUFDLENBQUEsS0FBSyxDQUFDLE1BQVAsQ0FBYyxRQUFBLENBQUMsSUFBRCxDQUFBO2FBQVUsSUFBSSxDQUFDLEVBQUwsS0FBVztJQUFyQixDQUFkO0lBQ1QsSUFBQyxDQUFBLEtBQUQsQ0FBQTtXQUNBO0VBSlE7O0VBTVQsS0FBUSxDQUFDLEVBQUQsRUFBSSxJQUFKLENBQUE7QUFDUCxRQUFBO0lBQUEsSUFBQSxHQUFPLElBQUMsQ0FBQSxLQUFLLENBQUMsSUFBUCxDQUFZLFFBQUEsQ0FBQyxJQUFELENBQUE7YUFBVSxJQUFJLENBQUMsRUFBTCxLQUFXO0lBQXJCLENBQVo7SUFDUCxJQUFHLElBQUksQ0FBQyxJQUFSO01BQWtCLElBQUksQ0FBQyxJQUFMLEdBQVksSUFBSSxDQUFDLEtBQW5DOztJQUNBLElBQUcsSUFBSSxDQUFDLElBQVI7TUFBa0IsSUFBSSxDQUFDLElBQUwsR0FBWSxJQUFJLENBQUMsS0FBTCxDQUFXLElBQUksQ0FBQyxJQUFoQixFQUE5Qjs7SUFDQSxJQUFDLENBQUEsS0FBRCxDQUFBO1dBQ0E7RUFMTzs7QUF2QlQ7O0FBOEJBLEVBQUEsR0FBSyxJQUFJLFFBQUosQ0FBYSxRQUFiOztBQUVMLEdBQUcsQ0FBQyxJQUFKLENBQVcsUUFBWCxFQUF5QixRQUFBLENBQUMsR0FBRCxFQUFNLEdBQU4sQ0FBQTtTQUFjLEdBQUcsQ0FBQyxJQUFKLENBQVMsRUFBRSxDQUFDLEdBQUgsQ0FBTyxHQUFHLENBQUMsSUFBWCxDQUFUO0FBQWQsQ0FBekI7O0FBQ0EsR0FBRyxDQUFDLEdBQUosQ0FBVyxRQUFYLEVBQXlCLFFBQUEsQ0FBQyxHQUFELEVBQU0sR0FBTixDQUFBO1NBQWMsR0FBRyxDQUFDLElBQUosQ0FBUyxFQUFFLENBQUMsS0FBWjtBQUFkLENBQXpCOztBQUNBLEdBQUcsQ0FBQyxHQUFKLENBQVcsWUFBWCxFQUF5QixRQUFBLENBQUMsR0FBRCxFQUFNLEdBQU4sQ0FBQTtTQUFjLEdBQUcsQ0FBQyxJQUFKLENBQVMsRUFBRSxDQUFDLEtBQUssQ0FBQyxJQUFULENBQWMsUUFBQSxDQUFDLElBQUQsQ0FBQTtXQUFVLElBQUksQ0FBQyxFQUFMLEtBQVcsR0FBRyxDQUFDLE1BQU0sQ0FBQztFQUFoQyxDQUFkLENBQVQ7QUFBZCxDQUF6Qjs7QUFDQSxHQUFHLENBQUMsS0FBSixDQUFXLFlBQVgsRUFBeUIsUUFBQSxDQUFDLEdBQUQsRUFBTSxHQUFOLENBQUE7U0FBYyxHQUFHLENBQUMsSUFBSixDQUFTLEVBQUUsQ0FBQyxLQUFILENBQVUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFyQixFQUF5QixHQUFHLENBQUMsSUFBN0IsQ0FBVDtBQUFkLENBQXpCOztBQUNBLEdBQUcsQ0FBQyxNQUFKLENBQVcsWUFBWCxFQUF5QixRQUFBLENBQUMsR0FBRCxFQUFNLEdBQU4sQ0FBQTtTQUFjLEdBQUcsQ0FBQyxJQUFKLENBQVMsRUFBRSxDQUFDLE1BQUgsQ0FBVSxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQXJCLENBQVQ7QUFBZCxDQUF6Qjs7QUFDQSxHQUFHLENBQUMsTUFBSixDQUFXLFFBQVgsRUFBeUIsUUFBQSxDQUFDLEdBQUQsRUFBTSxHQUFOLENBQUE7U0FBYyxHQUFHLENBQUMsSUFBSixDQUFTLEVBQUUsQ0FBQyxLQUFILENBQUEsQ0FBVDtBQUFkLENBQXpCOztBQUVBLElBQUEsR0FBTyxPQUFPLENBQUMsR0FBRyxDQUFDLElBQVosSUFBb0I7O0FBQzNCLEdBQUcsQ0FBQyxNQUFKLENBQVcsSUFBWCxFQUFpQixRQUFBLENBQUEsQ0FBQTtTQUFHLE9BQU8sQ0FBQyxHQUFSLENBQVksQ0FBQSx1QkFBQSxDQUFBLENBQTBCLElBQTFCLENBQUEsQ0FBWjtBQUFILENBQWpCIiwic291cmNlc0NvbnRlbnQiOlsie3JlYWRGaWxlU3luYywgd3JpdGVGaWxlU3luY30gPSByZXF1aXJlICdmcydcclxue2xhc3R9ID0gcmVxdWlyZSAnbG9kYXNoJ1xyXG5cclxuZXhwcmVzcyA9IHJlcXVpcmUgJ2V4cHJlc3MnXHJcbmFwcCA9IGV4cHJlc3MoKVxyXG5hcHAudXNlIGV4cHJlc3MudXJsZW5jb2RlZCB7IGV4dGVuZGVkOiBmYWxzZSB9ICMgcmVxLmJvZHlcclxuXHJcbmNsYXNzIERhdGFiYXNlICAgIyB0b2RvID0ge2lkOlwiMVwiLCB0ZXh0OlwiRmVlZCB0aGUgQ2F0XCIsIGRvbmU6ZmFsc2V9XHJcblx0Y29uc3RydWN0b3IgOiAoQHBhdGgpIC0+IEByZWFkKClcclxuXHJcblx0cmVhZCA6IC0+IE9iamVjdC5hc3NpZ24gQCwgSlNPTi5wYXJzZSByZWFkRmlsZVN5bmMgQHBhdGgsJ3V0Zi04J1xyXG5cdHdyaXRlIDogLT4gd3JpdGVGaWxlU3luYyBAcGF0aCwgSlNPTi5zdHJpbmdpZnkgQFxyXG5cclxuXHRhZGQgOiAoYm9keSkgLT4gXHJcblx0XHRAdG9kb3MucHVzaCB7aWQ6IFwiI3srK0BsYXN0fVwiLCB0ZXh0OiBib2R5LnRleHQsIGRvbmU6IGZhbHNlfVxyXG5cdFx0QHdyaXRlKClcclxuXHRcdGxhc3QgQHRvZG9zXHJcblxyXG5cdGNsZWFyIDogLT5cclxuXHRcdEBsYXN0ID0gMFxyXG5cdFx0QHRvZG9zID0gW11cclxuXHRcdEB3cml0ZSgpXHJcblx0XHRAdG9kb3NcclxuXHJcblx0ZGVsZXRlIDogKGlkKSAtPlxyXG5cdFx0dG9kbyA9IEB0b2Rvcy5maW5kICh0b2RvKSAtPiB0b2RvLmlkID09IGlkXHJcblx0XHRAdG9kb3MgPSBAdG9kb3MuZmlsdGVyICh0b2RvKSAtPiB0b2RvLmlkICE9IGlkXHJcblx0XHRAd3JpdGUoKVxyXG5cdFx0dG9kb1xyXG5cclxuXHRwYXRjaCA6IChpZCxib2R5KSAtPlxyXG5cdFx0dG9kbyA9IEB0b2Rvcy5maW5kICh0b2RvKSAtPiB0b2RvLmlkID09IGlkXHJcblx0XHRpZiBib2R5LnRleHQgdGhlbiB0b2RvLnRleHQgPSBib2R5LnRleHRcclxuXHRcdGlmIGJvZHkuZG9uZSB0aGVuIHRvZG8uZG9uZSA9IEpTT04ucGFyc2UgYm9keS5kb25lXHJcblx0XHRAd3JpdGUoKVxyXG5cdFx0dG9kb1xyXG5cclxuZGIgPSBuZXcgRGF0YWJhc2UgJ2RiLnR4dCdcclxuXHJcbmFwcC5wb3N0ICAgJy90b2RvcycsICAgICAocmVxLCByZXMpIC0+IHJlcy5zZW5kIGRiLmFkZCByZXEuYm9keVxyXG5hcHAuZ2V0ICAgICcvdG9kb3MnLCAgICAgKHJlcSwgcmVzKSAtPiByZXMuc2VuZCBkYi50b2Rvc1xyXG5hcHAuZ2V0ICAgICcvdG9kb3MvOmlkJywgKHJlcSwgcmVzKSAtPiByZXMuc2VuZCBkYi50b2Rvcy5maW5kICh0b2RvKSAtPiB0b2RvLmlkID09IHJlcS5wYXJhbXMuaWRcclxuYXBwLnBhdGNoICAnL3RvZG9zLzppZCcsIChyZXEsIHJlcykgLT4gcmVzLnNlbmQgZGIucGF0Y2ggIHJlcS5wYXJhbXMuaWQsIHJlcS5ib2R5XHJcbmFwcC5kZWxldGUgJy90b2Rvcy86aWQnLCAocmVxLCByZXMpIC0+IHJlcy5zZW5kIGRiLmRlbGV0ZSByZXEucGFyYW1zLmlkXHJcbmFwcC5kZWxldGUgJy90b2RvcycsICAgICAocmVxLCByZXMpIC0+IHJlcy5zZW5kIGRiLmNsZWFyKClcclxuXHJcblBPUlQgPSBwcm9jZXNzLmVudi5QT1JUIHx8IDMwMDBcclxuYXBwLmxpc3RlbiBQT1JULCAtPiBjb25zb2xlLmxvZyBcIlNlcnZlciBzdGFydGVkIG9uIHBvcnQgI3tQT1JUfVwiIl19
//# sourceURL=c:\github\LiveShare\2019-09-26\coffee\index.coffee