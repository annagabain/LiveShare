// Generated by CoffeeScript 2.4.1
var Database, PATH, PORT, _, app, db, express, fs;

fs = require('fs');

_ = require('lodash');

PATH = 'db.txt';

express = require('express');

app = express();

app.use(express.urlencoded({
  extended: false // req.body
}));


// Todo:
// id   1..
// text "Feed the Cat"
// done false
Database = class Database {
  constructor() {
    this.clear();
    this.demo();
  }

  read() {
    return Object.assign(this, JSON.parse(fs.readFileSync(PATH, 'utf-8')));
  }

  write() {
    return fs.writeFileSync(PATH, JSON.stringify(this));
  }

  add(text) {
    this.todos.push({
      id: ++this.last,
      text: text,
      done: false
    });
    return this.write();
  }

  clear() {
    this.last = 0;
    this.todos = [];
    return this.write();
  }

  delete(id) {
    var result;
    result = this.todos.find(function(todo) {
      return todo.id === id;
    });
    this.todos = this.todos.filter(function(todo) {
      return todo.id !== id;
    });
    this.write();
    return result;
  }

  demo() {
    var i, len, ref, results, text;
    ref = 'buy food|fetch lamps|walk dog|feed cat|köp räksmörgåsar'.split('|');
    results = [];
    for (i = 0, len = ref.length; i < len; i++) {
      text = ref[i];
      results.push(this.add(text));
    }
    return results;
  }

};

db = new Database();

app.post('/todos/demo', function(req, res) {
  db.clear();
  db.demo();
  return res.send(db.todos);
});

app.post('/todos', function(req, res) {
  db.add(req.body.text);
  return res.send(_.last(db.todos));
});

app.get('/todos', function(req, res) {
  return res.send(db.todos);
});

app.get('/todos/:id', function(req, res) {
  return res.send(db.todos.find(function(todo) {
    return todo.id === parseInt(req.params.id);
  }));
});

app.put('/todos', function(req, res) {
  var todo;
  todo = db.todos.find(function(todo) {
    return todo.id === parseInt(req.body.id);
  });
  todo.text = req.body.text;
  todo.done = JSON.parse(req.body.done);
  db.write();
  return res.send(todo);
});

app.patch('/todos', function(req, res) {
  var todo;
  todo = db.todos.find(function(todo) {
    return todo.id === parseInt(req.body.id);
  });
  if (req.body.text) {
    todo.text = req.body.text;
  }
  if (req.body.done) {
    todo.done = JSON.parse(req.body.done);
  }
  db.write();
  return res.send(todo);
});

app.delete('/todos', function(req, res) {
  db.clear();
  return res.send(db.todos);
});

app.delete('/todos/:id', function(req, res) {
  return res.send(db.delete(parseInt(req.params.id)));
});

PORT = process.env.PORT || 3000;

app.listen(PORT, function() {
  return console.log(`Server started on port ${PORT}`);
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiLi4iLCJzb3VyY2VzIjpbImNvZmZlZVxcaW5kZXguY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxJQUFBLFFBQUEsRUFBQSxJQUFBLEVBQUEsSUFBQSxFQUFBLENBQUEsRUFBQSxHQUFBLEVBQUEsRUFBQSxFQUFBLE9BQUEsRUFBQTs7QUFBQSxFQUFBLEdBQUssT0FBQSxDQUFRLElBQVI7O0FBQ0wsQ0FBQSxHQUFJLE9BQUEsQ0FBUSxRQUFSOztBQUNKLElBQUEsR0FBTzs7QUFFUCxPQUFBLEdBQVUsT0FBQSxDQUFRLFNBQVI7O0FBQ1YsR0FBQSxHQUFNLE9BQUEsQ0FBQTs7QUFDTixHQUFHLENBQUMsR0FBSixDQUFRLE9BQU8sQ0FBQyxVQUFSLENBQW1CO0VBQUUsUUFBQSxFQUFVLEtBQVo7QUFBQSxDQUFuQixDQUFSLEVBTkE7Ozs7Ozs7QUFhTSxXQUFOLE1BQUEsU0FBQTtFQUNDLFdBQWMsQ0FBQSxDQUFBO0lBQ2IsSUFBQyxDQUFBLEtBQUQsQ0FBQTtJQUNBLElBQUMsQ0FBQSxJQUFELENBQUE7RUFGYTs7RUFJZCxJQUFPLENBQUEsQ0FBQTtXQUFHLE1BQU0sQ0FBQyxNQUFQLENBQWMsSUFBZCxFQUFpQixJQUFJLENBQUMsS0FBTCxDQUFXLEVBQUUsQ0FBQyxZQUFILENBQWdCLElBQWhCLEVBQXFCLE9BQXJCLENBQVgsQ0FBakI7RUFBSDs7RUFDUCxLQUFRLENBQUEsQ0FBQTtXQUFHLEVBQUUsQ0FBQyxhQUFILENBQWlCLElBQWpCLEVBQXVCLElBQUksQ0FBQyxTQUFMLENBQWUsSUFBZixDQUF2QjtFQUFIOztFQUVSLEdBQU0sQ0FBQyxJQUFELENBQUE7SUFDTCxJQUFDLENBQUEsS0FBSyxDQUFDLElBQVAsQ0FBWTtNQUFDLEVBQUEsRUFBSSxFQUFFLElBQUMsQ0FBQSxJQUFSO01BQWMsSUFBQSxFQUFNLElBQXBCO01BQTBCLElBQUEsRUFBTTtJQUFoQyxDQUFaO1dBQ0EsSUFBQyxDQUFBLEtB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ZnMnXHJcbl8gPSByZXF1aXJlICdsb2Rhc2gnXHJcblBBVEggPSAnZGIudHh0J1xyXG5cclxuZXhwcmVzcyA9IHJlcXVpcmUgJ2V4cHJlc3MnXHJcbmFwcCA9IGV4cHJlc3MoKVxyXG5hcHAudXNlIGV4cHJlc3MudXJsZW5jb2RlZCB7IGV4dGVuZGVkOiBmYWxzZSB9ICMgcmVxLmJvZHlcclxuXHJcbiMgVG9kbzpcclxuIyBpZCAgIDEuLlxyXG4jIHRleHQgXCJGZWVkIHRoZSBDYXRcIlxyXG4jIGRvbmUgZmFsc2VcclxuXHJcbmNsYXNzIERhdGFiYXNlIFxyXG5cdGNvbnN0cnVjdG9yIDogKCkgLT4gXHJcblx0XHRAY2xlYXIoKVxyXG5cdFx0QGRlbW8oKVxyXG5cclxuXHRyZWFkIDogLT4gT2JqZWN0LmFzc2lnbiBALCBKU09OLnBhcnNlIGZzLnJlYWRGaWxlU3luYyBQQVRILCd1dGYtOCdcclxuXHR3cml0ZSA6IC0+IGZzLndyaXRlRmlsZVN5bmMgUEFUSCwgSlNPTi5zdHJpbmdpZnkgQFxyXG5cclxuXHRhZGQgOiAodGV4dCkgLT5cclxuXHRcdEB0b2Rvcy5wdXNoIHtpZDogKytAbGFzdCwgdGV4dDogdGV4dCwgZG9uZTogZmFsc2V9XHJcblx0XHRAd3JpdGUoKVxyXG5cclxuXHRjbGVhciA6ICgpIC0+XHJcblx0XHRAbGFzdCA9IDBcclxuXHRcdEB0b2RvcyA9IFtdXHJcblx0XHRAd3JpdGUoKVxyXG5cclxuXHRkZWxldGUgOiAoaWQpIC0+XHJcblx0XHRyZXN1bHQgPSBAdG9kb3MuZmluZCAodG9kbykgLT4gdG9kby5pZCA9PSBpZFxyXG5cdFx0QHRvZG9zID0gQHRvZG9zLmZpbHRlciAodG9kbykgLT4gdG9kby5pZCAhPSBpZFxyXG5cdFx0QHdyaXRlKClcclxuXHRcdHJlc3VsdFxyXG5cclxuXHRkZW1vIDogLT5cclxuXHRcdEBhZGQgdGV4dCBmb3IgdGV4dCBpbiAnYnV5IGZvb2R8ZmV0Y2ggbGFtcHN8d2FsayBkb2d8ZmVlZCBjYXR8a8O2cCByw6Rrc23DtnJnw6VzYXInLnNwbGl0ICd8J1xyXG5cclxuZGIgPSBuZXcgRGF0YWJhc2UoKVxyXG5cclxuYXBwLnBvc3QgJy90b2Rvcy9kZW1vJywgKHJlcSwgcmVzKSAtPlxyXG5cdGRiLmNsZWFyKClcclxuXHRkYi5kZW1vKClcclxuXHRyZXMuc2VuZCBkYi50b2Rvc1xyXG5cclxuYXBwLnBvc3QgJy90b2RvcycsIChyZXEsIHJlcykgLT5cclxuXHRkYi5hZGQgcmVxLmJvZHkudGV4dFxyXG5cdHJlcy5zZW5kIF8ubGFzdCBkYi50b2Rvc1xyXG5cclxuYXBwLmdldCAnL3RvZG9zJywgKHJlcSwgcmVzKSAtPiByZXMuc2VuZCBkYi50b2Rvc1xyXG5cclxuYXBwLmdldCAnL3RvZG9zLzppZCcsIChyZXEsIHJlcykgLT4gcmVzLnNlbmQgZGIudG9kb3MuZmluZCAodG9kbykgLT4gdG9kby5pZCA9PSBwYXJzZUludCByZXEucGFyYW1zLmlkXHJcblxyXG5hcHAucHV0ICcvdG9kb3MnLCAocmVxLCByZXMpIC0+IFxyXG5cdHRvZG8gPSBkYi50b2Rvcy5maW5kICh0b2RvKSAtPiB0b2RvLmlkID09IHBhcnNlSW50IHJlcS5ib2R5LmlkXHJcblx0dG9kby50ZXh0ID0gcmVxLmJvZHkudGV4dFxyXG5cdHRvZG8uZG9uZSA9IEpTT04ucGFyc2UgcmVxLmJvZHkuZG9uZVxyXG5cdGRiLndyaXRlKClcclxuXHRyZXMuc2VuZCB0b2RvXHJcblxyXG5hcHAucGF0Y2ggJy90b2RvcycsIChyZXEsIHJlcykgLT4gXHJcblx0dG9kbyA9IGRiLnRvZG9zLmZpbmQgKHRvZG8pIC0+IHRvZG8uaWQgPT0gcGFyc2VJbnQgcmVxLmJvZHkuaWRcclxuXHRpZiByZXEuYm9keS50ZXh0IHRoZW4gdG9kby50ZXh0ID0gcmVxLmJvZHkudGV4dFxyXG5cdGlmIHJlcS5ib2R5LmRvbmUgdGhlbiB0b2RvLmRvbmUgPSBKU09OLnBhcnNlIHJlcS5ib2R5LmRvbmVcclxuXHRkYi53cml0ZSgpXHJcblx0cmVzLnNlbmQgdG9kb1xyXG5cclxuYXBwLmRlbGV0ZSAnL3RvZG9zJywgKHJlcSwgcmVzKSAtPlxyXG5cdGRiLmNsZWFyKClcclxuXHRyZXMuc2VuZCBkYi50b2Rvc1xyXG5cclxuYXBwLmRlbGV0ZSAnL3RvZG9zLzppZCcsIChyZXEsIHJlcykgLT4gcmVzLnNlbmQgZGIuZGVsZXRlIHBhcnNlSW50IHJlcS5wYXJhbXMuaWRcclxuXHJcblBPUlQgPSBwcm9jZXNzLmVudi5QT1JUIHx8IDMwMDBcclxuYXBwLmxpc3RlbiBQT1JULCAtPiBjb25zb2xlLmxvZyBcIlNlcnZlciBzdGFydGVkIG9uIHBvcnQgI3tQT1JUfVwiIl19
//# sourceURL=c:\github\LiveShare\2019-09-26\coffee\index.coffee