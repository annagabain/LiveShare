// Generated by CoffeeScript 2.4.1
var Database, PATH, PORT, _, app, db, express, fs;

fs = require('fs');

_ = require('lodash');

PATH = 'db.txt';

express = require('express');

app = express();

app.use(express.urlencoded({
  extended: false // req.body
}));


// Todo:
// ID   1..
// Text "Feed the Cat"
// Done false
Database = class Database {
  constructor() {
    this.clear();
    this.demo();
  }

  read() {
    return Object.assign(this, JSON.parse(fs.readFileSync(PATH, 'utf-8')));
  }

  write() {
    return fs.writeFileSync(PATH, JSON.stringify(this));
  }

  add(text) {
    this.todos.push({
      id: ++this.last,
      text: text,
      done: false
    });
    return this.write();
  }

  clear() {
    this.last = 0;
    this.todos = [];
    return this.write();
  }

  delete(id) {
    this.todos = this.todos.filter(function(todo) {
      return todo.id !== id;
    });
    return this.write();
  }

  demo() {
    var i, len, ref, results, text;
    ref = 'buy food|fetch lamps|walk dog|feed cat|köp räksmörgåsar'.split('|');
    results = [];
    for (i = 0, len = ref.length; i < len; i++) {
      text = ref[i];
      results.push(this.add(text));
    }
    return results;
  }

};

db = new Database();

app.post('/todos/demo', function(req, res) {
  db.clear();
  db.demo();
  return res.send(db.todos);
});

app.post('/todos', function(req, res) {
  db.add(req.body.text);
  return res.send(_.last(db.todos));
});

app.get('/todos', function(req, res) {
  return res.send(db.todos);
});

app.get('/todos/:id', function(req, res) {
  return res.send(db.todos.find(function(todo) {
    return todo.id === parseInt(req.params.id);
  }));
});

app.put('/todos', function(req, res) {
  var todo;
  todo = db.todos.find(function(todo) {
    return todo.id === parseInt(req.body.id);
  });
  todo.text = req.body.text;
  todo.done = JSON.parse(req.body.done);
  db.write();
  return res.send(todo);
});

app.patch('/todos', function(req, res) {
  var todo;
  todo = db.todos.find(function(todo) {
    return todo.id === parseInt(req.body.id);
  });
  if (req.body.text) {
    todo.text = req.body.text;
  }
  if (req.body.done) {
    todo.done = JSON.parse(req.body.done);
  }
  db.write();
  return res.send(todo);
});

app.delete('/todos', function(req, res) {
  db.clear();
  return res.send(db.todos);
});

app.delete('/todos/:id', function(req, res) {
  db.delete(parseInt(req.params.id));
  return res.send(`The item with id=${req.params.id} was deleted`);
});

PORT = process.env.PORT || 3000;

app.listen(PORT, function() {
  return console.log(`Server started on port ${PORT}`);
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiLi4iLCJzb3VyY2VzIjpbImNvZmZlZVxcaW5kZXguY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxJQUFBLFFBQUEsRUFBQSxJQUFBLEVBQUEsSUFBQSxFQUFBLENBQUEsRUFBQSxHQUFBLEVBQUEsRUFBQSxFQUFBLE9BQUEsRUFBQTs7QUFBQSxFQUFBLEdBQUssT0FBQSxDQUFRLElBQVI7O0FBQ0wsQ0FBQSxHQUFJLE9BQUEsQ0FBUSxRQUFSOztBQUNKLElBQUEsR0FBTzs7QUFFUCxPQUFBLEdBQVUsT0FBQSxDQUFRLFNBQVI7O0FBQ1YsR0FBQSxHQUFNLE9BQUEsQ0FBQTs7QUFDTixHQUFHLENBQUMsR0FBSixDQUFRLE9BQU8sQ0FBQyxVQUFSLENBQW1CO0VBQUUsUUFBQSxFQUFVLEtBQVo7QUFBQSxDQUFuQixDQUFSLEVBTkE7Ozs7Ozs7QUFhTSxXQUFOLE1BQUEsU0FBQTtFQUNDLFdBQWMsQ0FBQSxDQUFBO0lBQ2IsSUFBQyxDQUFBLEtBQUQsQ0FBQTtJQUNBLElBQUMsQ0FBQSxJQUFELENBQUE7RUFGYTs7RUFJZCxJQUFPLENBQUEsQ0FBQTtXQUFHLE1BQU0sQ0FBQyxNQUFQLENBQWMsSUFBZCxFQUFpQixJQUFJLENBQUMsS0FBTCxDQUFXLEVBQUUsQ0FBQyxZQUFILENBQWdCLElBQWhCLEVBQXFCLE9BQXJCLENBQVgsQ0FBakI7RUFBSDs7RUFDUCxLQUFRLENBQUEsQ0FBQTtXQUFHLEVBQUUsQ0FBQyxhQUFILENBQWlCLElBQWpCLEVBQXVCLElBQUksQ0FBQyxTQUFMLENBQWUsSUFBZixDQUF2QjtFQUFIOztFQUVSLEdBQU0sQ0FBQyxJQUFELENBQUE7SUFDTCxJQUFDLENBQUEsS0FBSyxDQUFDLElBQVAsQ0FBWTtNQUFDLEVBQUEsRUFBSSxFQUFFLElBQUMsQ0FBQSxJQUFSO01BQWMsSUFBQSxFQUFNLElBQXBCO01BQTBCLElBQUEsRUFBTTtJQUFoQyxDQUFaO1dBQ0EsSUFBQyxDQUFBLEtB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QUcsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFaO0lBQXNCLElBQUksQ0FBQyxJQUFMLEdBQVksR0FBRyxDQUFDLElBQUksQ0FBQyxLQUEzQzs7RUFDQSxJQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBWjtJQUFzQixJQUFJLENBQUMsSUFBTCxHQUFZLElBQUksQ0FBQyxLQUFMLENBQVcsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFwQixFQUFsQzs7RUFDQSxFQUFFLENBQUMsS0FBSCxDQUFBO1NBQ0EsR0FBRyxDQUFDLElBQUosQ0FBUyxJQUFUO0FBTG1CLENBQXBCOztBQU9BLEdBQUcsQ0FBQyxNQUFKLENBQVcsUUFBWCxFQUFxQixRQUFBLENBQUMsR0FBRCxFQUFNLEdBQU4sQ0FBQTtFQUNwQixFQUFFLENBQUMsS0FBSCxDQUFBO1NBQ0EsR0FBRyxDQUFDLElBQUosQ0FBUyxFQUFFLENBQUMsS0FBWjtBQUZvQixDQUFyQjs7QUFJQSxHQUFHLENBQUMsTUFBSixDQUFXLFlBQVgsRUFBeUIsUUFBQSxDQUFDLEdBQUQsRUFBTSxHQUFOLENBQUE7RUFDeEIsRUFBRSxDQUFDLE1BQUgsQ0FBVSxRQUFBLENBQVMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFwQixDQUFWO1NBQ0EsR0FBRyxDQUFDLElBQUosQ0FBUyxDQUFBLGlCQUFBLENBQUEsQ0FBb0IsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUEvQixDQUFrQyxZQUFsQyxDQUFUO0FBRndCLENBQXpCOztBQUlBLElBQUEsR0FBTyxPQUFPLENBQUMsR0FBRyxDQUFDLElBQVosSUFBb0I7O0FBQzNCLEdBQUcsQ0FBQyxNQUFKLENBQVcsSUFBWCxFQUFpQixRQUFBLENBQUEsQ0FBQTtTQUFHLE9BQU8sQ0FBQyxHQUFSLENBQVksQ0FBQSx1QkFBQSxDQUFBLENBQTBCLElBQTFCLENBQUEsQ0FBWjtBQUFILENBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiZnMgPSByZXF1aXJlICdmcydcclxuXyA9IHJlcXVpcmUgJ2xvZGFzaCdcclxuUEFUSCA9ICdkYi50eHQnXHJcblxyXG5leHByZXNzID0gcmVxdWlyZSAnZXhwcmVzcydcclxuYXBwID0gZXhwcmVzcygpXHJcbmFwcC51c2UgZXhwcmVzcy51cmxlbmNvZGVkIHsgZXh0ZW5kZWQ6IGZhbHNlIH0gIyByZXEuYm9keVxyXG5cclxuIyBUb2RvOlxyXG4jIElEICAgMS4uXHJcbiMgVGV4dCBcIkZlZWQgdGhlIENhdFwiXHJcbiMgRG9uZSBmYWxzZVxyXG5cclxuY2xhc3MgRGF0YWJhc2UgXHJcblx0Y29uc3RydWN0b3IgOiAoKSAtPiBcclxuXHRcdEBjbGVhcigpXHJcblx0XHRAZGVtbygpXHJcblxyXG5cdHJlYWQgOiAtPiBPYmplY3QuYXNzaWduIEAsIEpTT04ucGFyc2UgZnMucmVhZEZpbGVTeW5jIFBBVEgsJ3V0Zi04J1xyXG5cdHdyaXRlIDogLT4gZnMud3JpdGVGaWxlU3luYyBQQVRILCBKU09OLnN0cmluZ2lmeSBAXHJcblxyXG5cdGFkZCA6ICh0ZXh0KSAtPlxyXG5cdFx0QHRvZG9zLnB1c2gge2lkOiArK0BsYXN0LCB0ZXh0OiB0ZXh0LCBkb25lOiBmYWxzZX1cclxuXHRcdEB3cml0ZSgpXHJcblxyXG5cdGNsZWFyIDogKCkgLT5cclxuXHRcdEBsYXN0ID0gMFxyXG5cdFx0QHRvZG9zID0gW11cclxuXHRcdEB3cml0ZSgpXHJcblxyXG5cdGRlbGV0ZSA6IChpZCkgLT5cclxuXHRcdEB0b2RvcyA9IEB0b2Rvcy5maWx0ZXIgKHRvZG8pIC0+IHRvZG8uaWQgIT0gaWRcclxuXHRcdEB3cml0ZSgpXHJcblxyXG5cdGRlbW8gOiAtPlxyXG5cdFx0QGFkZCB0ZXh0IGZvciB0ZXh0IGluICdidXkgZm9vZHxmZXRjaCBsYW1wc3x3YWxrIGRvZ3xmZWVkIGNhdHxrw7ZwIHLDpGtzbcO2cmfDpXNhcicuc3BsaXQgJ3wnXHJcblxyXG5kYiA9IG5ldyBEYXRhYmFzZSgpXHJcblxyXG5hcHAucG9zdCAnL3RvZG9zL2RlbW8nLCAocmVxLCByZXMpIC0+XHJcblx0ZGIuY2xlYXIoKVxyXG5cdGRiLmRlbW8oKVxyXG5cdHJlcy5zZW5kIGRiLnRvZG9zXHJcblxyXG5hcHAucG9zdCAnL3RvZG9zJywgKHJlcSwgcmVzKSAtPlxyXG5cdGRiLmFkZCByZXEuYm9keS50ZXh0XHJcblx0cmVzLnNlbmQgXy5sYXN0IGRiLnRvZG9zXHJcblxyXG5hcHAuZ2V0ICcvdG9kb3MnLCAocmVxLCByZXMpIC0+IHJlcy5zZW5kIGRiLnRvZG9zXHJcblxyXG5hcHAuZ2V0ICcvdG9kb3MvOmlkJywgKHJlcSwgcmVzKSAtPiByZXMuc2VuZCBkYi50b2Rvcy5maW5kICh0b2RvKSAtPiB0b2RvLmlkID09IHBhcnNlSW50IHJlcS5wYXJhbXMuaWRcclxuXHJcbmFwcC5wdXQgJy90b2RvcycsIChyZXEsIHJlcykgLT4gXHJcblx0dG9kbyA9IGRiLnRvZG9zLmZpbmQgKHRvZG8pIC0+IHRvZG8uaWQgPT0gcGFyc2VJbnQgcmVxLmJvZHkuaWRcclxuXHR0b2RvLnRleHQgPSByZXEuYm9keS50ZXh0XHJcblx0dG9kby5kb25lID0gSlNPTi5wYXJzZSByZXEuYm9keS5kb25lXHJcblx0ZGIud3JpdGUoKVxyXG5cdHJlcy5zZW5kIHRvZG9cclxuXHJcbmFwcC5wYXRjaCAnL3RvZG9zJywgKHJlcSwgcmVzKSAtPiBcclxuXHR0b2RvID0gZGIudG9kb3MuZmluZCAodG9kbykgLT4gdG9kby5pZCA9PSBwYXJzZUludCByZXEuYm9keS5pZFxyXG5cdGlmIHJlcS5ib2R5LnRleHQgdGhlbiB0b2RvLnRleHQgPSByZXEuYm9keS50ZXh0XHJcblx0aWYgcmVxLmJvZHkuZG9uZSB0aGVuIHRvZG8uZG9uZSA9IEpTT04ucGFyc2UgcmVxLmJvZHkuZG9uZVxyXG5cdGRiLndyaXRlKClcclxuXHRyZXMuc2VuZCB0b2RvXHJcblxyXG5hcHAuZGVsZXRlICcvdG9kb3MnLCAocmVxLCByZXMpIC0+XHJcblx0ZGIuY2xlYXIoKVxyXG5cdHJlcy5zZW5kIGRiLnRvZG9zXHJcblxyXG5hcHAuZGVsZXRlICcvdG9kb3MvOmlkJywgKHJlcSwgcmVzKSAtPlxyXG5cdGRiLmRlbGV0ZSBwYXJzZUludCByZXEucGFyYW1zLmlkXHJcblx0cmVzLnNlbmQgXCJUaGUgaXRlbSB3aXRoIGlkPSN7cmVxLnBhcmFtcy5pZH0gd2FzIGRlbGV0ZWRcIlxyXG5cclxuUE9SVCA9IHByb2Nlc3MuZW52LlBPUlQgfHwgMzAwMFxyXG5hcHAubGlzdGVuIFBPUlQsIC0+IGNvbnNvbGUubG9nIFwiU2VydmVyIHN0YXJ0ZWQgb24gcG9ydCAje1BPUlR9XCIiXX0=
//# sourceURL=c:\github\LiveShare\2019-09-26\coffee\index.coffee