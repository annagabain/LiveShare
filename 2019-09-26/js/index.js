// Generated by CoffeeScript 2.4.1
var Database, PORT, app, db, express, last, readFileSync, writeFileSync;

({readFileSync, writeFileSync} = require('fs'));

({last} = require('lodash'));

express = require('express');

app = express();

app.use(express.urlencoded({
  extended: false // req.body
}));

Database = class Database { // todo = {id:"1", text:"Feed the Cat", done:false}
  constructor(path) {
    this.path = path;
    this.read();
  }

  read() {
    return Object.assign(this, JSON.parse(readFileSync(this.path, 'utf-8')));
  }

  write() {
    return writeFileSync(this.path, JSON.stringify(this));
  }

  add(body) {
    this.todos.push({
      id: (++this.last).toString(),
      text: body.text,
      done: false
    });
    this.write();
    return last(this.todos);
  }

  clear() {
    this.last = 0;
    this.todos = [];
    this.write();
    return this.todos;
  }

  delete(id) {
    var result;
    result = this.todos.find(function(todo) {
      return todo.id === id;
    });
    this.todos = this.todos.filter(function(todo) {
      return todo.id !== id;
    });
    this.write();
    return result;
  }

  patch(id, body) {
    var todo;
    todo = this.todos.find(function(todo) {
      return todo.id === id;
    });
    if (body.text) {
      todo.text = body.text;
    }
    if (body.done) {
      todo.done = JSON.parse(body.done);
    }
    this.write();
    return todo;
  }

};

db = new Database('db.txt');

app.post('/todos', function(req, res) {
  return res.send(db.add(req.body));
});

app.get('/todos', function(req, res) {
  return res.send(db.todos);
});

app.get('/todos/:id', function(req, res) {
  return res.send(db.todos.find(function(todo) {
    return todo.id === req.params.id;
  }));
});

app.patch('/todos/:id', function(req, res) {
  return res.send(db.patch(req.params.id, req.body));
});

app.delete('/todos', function(req, res) {
  return res.send(db.clear());
});

app.delete('/todos/:id', function(req, res) {
  return res.send(db.delete(req.params.id));
});

PORT = process.env.PORT || 3000;

app.listen(PORT, function() {
  return console.log(`Server started on port ${PORT}`);
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiLi4iLCJzb3VyY2VzIjpbImNvZmZlZVxcaW5kZXguY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxJQUFBLFFBQUEsRUFBQSxJQUFBLEVBQUEsR0FBQSxFQUFBLEVBQUEsRUFBQSxPQUFBLEVBQUEsSUFBQSxFQUFBLFlBQUEsRUFBQTs7QUFBQSxDQUFBLENBQUMsWUFBRCxFQUFlLGFBQWYsQ0FBQSxHQUFnQyxPQUFBLENBQVEsSUFBUixDQUFoQzs7QUFDQSxDQUFBLENBQUMsSUFBRCxDQUFBLEdBQVMsT0FBQSxDQUFRLFFBQVIsQ0FBVDs7QUFFQSxPQUFBLEdBQVUsT0FBQSxDQUFRLFNBQVI7O0FBQ1YsR0FBQSxHQUFNLE9BQUEsQ0FBQTs7QUFDTixHQUFHLENBQUMsR0FBSixDQUFRLE9BQU8sQ0FBQyxVQUFSLENBQW1CO0VBQUUsUUFBQSxFQUFVLEtBQVo7QUFBQSxDQUFuQixDQUFSOztBQUVNLFdBQU4sTUFBQSxTQUFBLENBQUE7RUFDQyxXQUFjLEtBQUEsQ0FBQTtJQUFDLElBQUMsQ0FBQTtJQUFTLElBQUMsQ0FBQSxJQUFELENBQUE7RUFBWDs7RUFFZCxJQUFPLENBQUEsQ0FBQTtXQUFHLE1BQU0sQ0FBQyxNQUFQLENBQWMsSUFBZCxFQUFpQixJQUFJLENBQUMsS0FBTCxDQUFXLFlBQUEsQ0FBYSxJQUFDLENBQUEsSUFBZCxFQUFtQixPQUFuQixDQUFYLENBQWpCO0VBQUg7O0VBQ1AsS0FBUSxDQUFBLENBQUE7V0FBRyxhQUFBLENBQWMsSUFBQyxDQUFBLElBQWYsRUFBcUIsSUFBSSxDQUFDLFNBQUwsQ0FBZSxJQUFmLENBQXJCO0VBQUg7O0VBRVIsR0FBTSxDQUFDLElBQUQsQ0FBQTtJQUNMLElBQUMsQ0FBQSxLQUFLLENBQUMsSUFBUCxDQUFZO01BQUMsRUFBQSxFQUFJLENBQUMsRUFBRSxJQUFDLENBQUEsSUFBSixDQUFTLENBQUMsUUFBVixDQUFBLENBQUw7TUFBMkIsSUFBQSxFQUFNLElB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QUFyQixDQUFUO0FBQWQsQ0FBekI7O0FBRUEsSUFBQSxHQUFPLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBWixJQUFvQjs7QUFDM0IsR0FBRyxDQUFDLE1BQUosQ0FBVyxJQUFYLEVBQWlCLFFBQUEsQ0FBQSxDQUFBO1NBQUcsT0FBTyxDQUFDLEdBQVIsQ0FBWSxDQUFBLHVCQUFBLENBQUEsQ0FBMEIsSUFBMUIsQ0FBQSxDQUFaO0FBQUgsQ0FBakIiLCJzb3VyY2VzQ29udGVudCI6WyJ7cmVhZEZpbGVTeW5jLCB3cml0ZUZpbGVTeW5jfSA9IHJlcXVpcmUgJ2ZzJ1xyXG57bGFzdH0gPSByZXF1aXJlICdsb2Rhc2gnXHJcblxyXG5leHByZXNzID0gcmVxdWlyZSAnZXhwcmVzcydcclxuYXBwID0gZXhwcmVzcygpXHJcbmFwcC51c2UgZXhwcmVzcy51cmxlbmNvZGVkIHsgZXh0ZW5kZWQ6IGZhbHNlIH0gIyByZXEuYm9keVxyXG5cclxuY2xhc3MgRGF0YWJhc2UgICAjIHRvZG8gPSB7aWQ6XCIxXCIsIHRleHQ6XCJGZWVkIHRoZSBDYXRcIiwgZG9uZTpmYWxzZX1cclxuXHRjb25zdHJ1Y3RvciA6IChAcGF0aCkgLT4gQHJlYWQoKVxyXG5cclxuXHRyZWFkIDogLT4gT2JqZWN0LmFzc2lnbiBALCBKU09OLnBhcnNlIHJlYWRGaWxlU3luYyBAcGF0aCwndXRmLTgnXHJcblx0d3JpdGUgOiAtPiB3cml0ZUZpbGVTeW5jIEBwYXRoLCBKU09OLnN0cmluZ2lmeSBAXHJcblxyXG5cdGFkZCA6IChib2R5KSAtPiBcclxuXHRcdEB0b2Rvcy5wdXNoIHtpZDogKCsrQGxhc3QpLnRvU3RyaW5nKCksIHRleHQ6IGJvZHkudGV4dCwgZG9uZTogZmFsc2V9XHJcblx0XHRAd3JpdGUoKVxyXG5cdFx0bGFzdCBAdG9kb3NcclxuXHJcblx0Y2xlYXIgOiAtPlxyXG5cdFx0QGxhc3QgPSAwXHJcblx0XHRAdG9kb3MgPSBbXVxyXG5cdFx0QHdyaXRlKClcclxuXHRcdEB0b2Rvc1xyXG5cclxuXHRkZWxldGUgOiAoaWQpIC0+XHJcblx0XHRyZXN1bHQgPSBAdG9kb3MuZmluZCAodG9kbykgLT4gdG9kby5pZCA9PSBpZFxyXG5cdFx0QHRvZG9zID0gQHRvZG9zLmZpbHRlciAodG9kbykgLT4gdG9kby5pZCAhPSBpZFxyXG5cdFx0QHdyaXRlKClcclxuXHRcdHJlc3VsdFxyXG5cclxuXHRwYXRjaCA6IChpZCxib2R5KSAtPlxyXG5cdFx0dG9kbyA9IEB0b2Rvcy5maW5kICh0b2RvKSAtPiB0b2RvLmlkID09IGlkXHJcblx0XHRpZiBib2R5LnRleHQgdGhlbiB0b2RvLnRleHQgPSBib2R5LnRleHRcclxuXHRcdGlmIGJvZHkuZG9uZSB0aGVuIHRvZG8uZG9uZSA9IEpTT04ucGFyc2UgYm9keS5kb25lXHJcblx0XHRAd3JpdGUoKVxyXG5cdFx0dG9kb1xyXG5cclxuZGIgPSBuZXcgRGF0YWJhc2UgJ2RiLnR4dCdcclxuXHJcbmFwcC5wb3N0ICAgJy90b2RvcycsICAgICAocmVxLCByZXMpIC0+IHJlcy5zZW5kIGRiLmFkZCByZXEuYm9keVxyXG5hcHAuZ2V0ICAgICcvdG9kb3MnLCAgICAgKHJlcSwgcmVzKSAtPiByZXMuc2VuZCBkYi50b2Rvc1xyXG5hcHAuZ2V0ICAgICcvdG9kb3MvOmlkJywgKHJlcSwgcmVzKSAtPiByZXMuc2VuZCBkYi50b2Rvcy5maW5kICh0b2RvKSAtPiB0b2RvLmlkID09IHJlcS5wYXJhbXMuaWRcclxuYXBwLnBhdGNoICAnL3RvZG9zLzppZCcsIChyZXEsIHJlcykgLT4gcmVzLnNlbmQgZGIucGF0Y2ggIHJlcS5wYXJhbXMuaWQsIHJlcS5ib2R5XHJcbmFwcC5kZWxldGUgJy90b2RvcycsICAgICAocmVxLCByZXMpIC0+IHJlcy5zZW5kIGRiLmNsZWFyKClcclxuYXBwLmRlbGV0ZSAnL3RvZG9zLzppZCcsIChyZXEsIHJlcykgLT4gcmVzLnNlbmQgZGIuZGVsZXRlIHJlcS5wYXJhbXMuaWRcclxuXHJcblBPUlQgPSBwcm9jZXNzLmVudi5QT1JUIHx8IDMwMDBcclxuYXBwLmxpc3RlbiBQT1JULCAtPiBjb25zb2xlLmxvZyBcIlNlcnZlciBzdGFydGVkIG9uIHBvcnQgI3tQT1JUfVwiIl19
//# sourceURL=c:\github\LiveShare\2019-09-26\coffee\index.coffee